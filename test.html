<!doctype html>
<html>
<head>
    <title>Ping</title>
    <style>
        form.ramp-conn textarea {
            width: 100%;
            height: 90px;
        }

        textarea#rt {
            width: 100%;
            height: 200px;
        }

        h1 {
            font-family: monospace;
        }
    </style>
    <script src="dist/index.js"></script>
    <script src="http://cdnjs.cloudflare.com/ajax/libs/zepto/1.1.4/zepto.js"></script>

    <script>
        $(function() {
            $("#guid").text(window.hub.guid);

            $("form.ramp-conn").each(function () {
                var form = $(this);
                var addr = $(this.elements["addr"]).val();
                var span_id = form.find("#id");
                var peers = $(this.elements["peers"]);
                $(this.elements["use"]).change(function() {
                    if(this.checked) {
                        var conn = window.hub.connect(addr);
                        
                        conn.onIdentified.on(function(data) {
                            span_id.text(data.endpoint);
                        });

                        conn.onConnected.on(function(id) {
                            var list = peers.text().split("\n").filter(Boolean);
                            var index = list.indexOf(id);
                            if(index == -1) {
                                list.push(id);
                                peers.text(list.join("\n"));
                            }
                        });

                        conn.onDisconnected.on(function(id) {
                            var list = peers.text().split("\n").filter(Boolean);
                            var index = list.indexOf(id);
                            if(index >= 0) {
                                list.splice(index, 1);
                                peers.text(list.join("\n"));
                            }

                        });
                    } else {
                        span_id.text("");
                        peers.text("");
                        window.hub.disconnect(addr);
                    }                    
                });
            });
        });
    </script>
</head>
<body>
    <form id="ramp1" class="ramp-conn">
        <div>
            <input type="text" name="addr" value="ws://127.0.0.1:20500/">
            <input name="use" type="checkbox">
            <span id="id" type="text"></span>
        </div>
        <div>
            <textarea name="peers"></textarea>
        </div>
    </form>

    <form id="ramp2" class="ramp-conn">
        <div>
            <input type="text" name="addr" value="ws://127.0.0.1:20501/">
            <input name="use" type="checkbox">
            <span id="id" type="text"></span>
        </div>
        <div>
            <textarea name="peers"></textarea>
        </div>
    </form>

    <h1>GUID: <span id="guid"></span></h1>
    <textarea id="rt"></textarea>    
</body>
</html>